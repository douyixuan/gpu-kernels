<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Day 26 - GPU Kernels Learning Journey</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem 1rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .nav {
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .nav a {
            color: #667eea;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            transition: all 0.3s;
        }
        
        .nav a:hover {
            background: #667eea;
            color: white;
        }
        
        .container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .description {
            background: white;
            padding: 2rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
        }
        
        .description h2 {
            color: #667eea;
            margin-bottom: 1rem;
            border-bottom: 2px solid #667eea;
            padding-bottom: 0.5rem;
        }
        
        .description pre {
            background: #f5f5f5;
            padding: 1rem;
            border-radius: 5px;
            overflow-x: auto;
        }
        
        .file-section {
            background: white;
            margin-bottom: 2rem;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .file-section h3 {
            background: #667eea;
            color: white;
            padding: 1rem;
            margin: 0;
        }
        
        .file-section pre {
            margin: 0;
            border-radius: 0;
        }
        
        .file-section code {
            display: block;
            padding: 1.5rem;
            max-height: 600px;
            overflow: auto;
        }
        
        .no-files {
            text-align: center;
            padding: 3rem;
            color: #999;
            font-style: italic;
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .nav-content {
                flex-direction: column;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>Day 26</h1>
        <div class="subtitle">GPU Kernels Learning Journey</div>
    </div>
    
    <nav class="nav">
        <div class="nav-content">
            <a href="index.html">← Back to Index</a>
            <div>
                <a href="day-25.html">← Day 25</a>
                <a href="day-27.html">Day 27 →</a>
            </div>
        </div>
    </nav>
    
    <div class="container">
        <div class="description">
            <h2>Description</h2>
            <div class="desc-content">
<h3>File: <code>hl_gauss.cu</code></h3>
<p><strong>Summary:</strong><br />
I implemented a CUDA-based Gaussian Histogram Loss (HL-Gauss), which computes probabilities for a histogram-based representation of data using the Gaussian kernel's cumulative distribution function. The implementation makes use of massively parallel computation on the GPU to efficiently handle large datasets. This approach is particularly useful in reinforcement learning, as outlined by work from DeepMind and related research papers.</p>
<hr />
            </div>
        </div>
        
        <h2 style="margin-bottom: 1rem; color: #667eea;">Code Files</h2>

    <div class="file-section">
        <h3>hl_gauss.cu</h3>
        <pre><code class="language-cpp">#include &lt;cuda_runtime.h&gt;
#include &lt;stdio.h&gt;
#include &lt;math.h&gt;


#define DEFAULT_SIGMA_TO_BIN_RATIO 2.0f
#define PI 3.14159265358979323846f
#define EPS 1e-10f


__device__ float erf_device(float x) {
    
    float t = 1.0f / (1.0f + 0.5f * fabsf(x));
    float tau = t * expf(-x * x - 1.26551223f + t * (1.00002368f + t * (0.37409196f + 
        t * (0.09678418f + t * (-0.18628806f + t * (0.27886807f + t * (-1.13520398f + 
        t * (1.48851587f + t * (-0.82215223f + t * 0.17087277f)))))))));
    return (x &gt;= 0) ? 1.0f - tau : tau - 1.0f;
}


__global__ void compute_histogram_probs(
    float* values,
    float* support,
    float* probs,
    int n_values,
    int n_bins,
    float sigma,
    float sigma_times_sqrt_two
) {
    int idx = blockIdx.x * blockDim.x + threadIdx.x;
    if (idx &gt;= n_values) return;

    float value = values[idx];
    
    
    for (int i = 0; i &lt; n_bins; i++) {
        float cdf_right = erf_device((support[i + 1] - value) / sigma_times_sqrt_two);
        float cdf_left = erf_device((support[i] - value) / sigma_times_sqrt_two);
        probs[idx * n_bins + i] = (cdf_right - cdf_left) / 2.0f;
    }
}


extern "C" void hlgauss_loss(
    float* d_values,
    float* d_support,
    float* d_probs,
    int n_values,
    int n_bins,
    float sigma
) {
    float sigma_times_sqrt_two = sigma * sqrtf(2.0f);

    
    int block_size = 256;
    int num_blocks = (n_values + block_size - 1) / block_size;
    
    compute_histogram_probs&lt;&lt;&lt;num_blocks, block_size&gt;&gt;&gt;(
        d_values,
        d_support,
        d_probs,
        n_values,
        n_bins,
        sigma,
        sigma_times_sqrt_two
    );
}

int main() {
   
    const int n_values = 1000;
    const int n_bins = 10;
    const float min_value = -5.0f;
    const float max_value = 5.0f;
    const float sigma = 1.0f;

    
    float* h_values = (float*)malloc(n_values * sizeof(float));
    float* h_support = (float*)malloc((n_bins + 1) * sizeof(float));
    float* h_probs = (float*)malloc(n_values * n_bins * sizeof(float));

    
    for (int i = 0; i &lt; n_values; i++) {
        h_values[i] = min_value + (max_value - min_value) * ((float)rand() / RAND_MAX);
    }
    
    
    float bin_width = (max_value - min_value) / n_bins;
    for (int i = 0; i &lt;= n_bins; i++) {
        h_support[i] = min_value + i * bin_width;
    }

    
    float *d_values, *d_support, *d_probs;
    cudaMalloc(&amp;d_values, n_values * sizeof(float));
    cudaMalloc(&amp;d_support, (n_bins + 1) * sizeof(float));
    cudaMalloc(&amp;d_probs, n_values * n_bins * sizeof(float));

    
    cudaMemcpy(d_values, h_values, n_values * sizeof(float), cudaMemcpyHostToDevice);
    cudaMemcpy(d_support, h_support, (n_bins + 1) * sizeof(float), cudaMemcpyHostToDevice);

   
    hlgauss_loss(d_values, d_support, d_probs, n_values, n_bins, sigma);

    
    cudaMemcpy(h_probs, d_probs, n_values * n_bins * sizeof(float), cudaMemcpyDeviceToHost);

    
    printf("First few probability distributions:\n");
    for (int i = 0; i &lt; 3; i++) {
        printf("Value %f: ", h_values[i]);
        for (int j = 0; j &lt; n_bins; j++) {
            printf("%f ", h_probs[i * n_bins + j]);
        }
        printf("\n");
    }

   
    free(h_values);
    free(h_support);
    free(h_probs);
    cudaFree(d_values);
    cudaFree(d_support);
    cudaFree(d_probs);

    return 0;
}
</code></pre>
    </div>

    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-c.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-cpp.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-markdown.min.js"></script>
</body>
</html>